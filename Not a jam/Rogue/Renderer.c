#ifndef RENDERER_DEF
#define RENDERER_DEF

#include <stdio.h>
#include <wchar.h>
#include <wctype.h>
#include <stdarg.h>

#include "Structs.h"
#include "ColorDefinitions.h"
#include "MacroHell.h"
#include "LinuxSpecial.h"
#include "PerlinNoise.h"

// ╔════════════════╦═══╦═══╗
// ║ ■              ║ _ ║ ╳ ║
// ╠════════════════╩═══╩═══╣
// ║                        ║
// ║                        ║
// ║                        ║
// ╚════════════════════════╝
static wchar_t *Pika[] =
    {
        L"%%&%########################################################(((////////////((((",
        L"#%%%%%\033[93m,\033[39m&((((((###############################################(((/////////((((((",
        L"&&%%%%\033[93m,,,,,\033[39m&((((##############################################(((((((((((((((((",
        L"###%%&\033[93m,,,,,,,,,\033[39m###########################################################%%%%%",
        L"((((%%\033[93m,,,,,,,,,,,,\033[39m################################################%%%%%%%%%%%%\033[93m,\033[39m",
        L"(((((&&\033[93m,,,,,,,,,,,,,,\033[39m%########################################%%%%%%%%%%%%&/\033[93m,,,\033[39m",
        L"((((((&\033[93m,,,,,,,,,,,,,,,,,\033[39m#####################################%%%%%%%&\033[93m,,,,,,,,,,\033[39m",
        L"((((((#&\033[93m,,,,,,,,,,,,,,,,,,,\033[39m##################################%%&*\033[93m,,,,,,,,,,,,,,\033[39m",
        L"(((((###%\033[93m,,,,,,,,,,,,,,,,,,,,\033[39m##############################&\033[93m,,,,,,,,,,,,,,,,,,,\033[39m",
        L"((((####%%\033[93m,,,,,,,,,,,,,,,,,,,,,\033[39m%######%&&&&%#(/****(#&&&\033[93m,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"((((###%%%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"((#####%%%%%%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"######%%%%%%%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"%%%%%%%%%%%%%%%%&\033[93m,,,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m%(",
        L"%%%%%%%%%%%%%%%%%%&\033[93m(,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m&(((",
        L"%%%%%%%%%%%%%%%%%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,(,\033[39m#((((((",
        L"%%%%%%%%%%%%%%%%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m%####((",
        L"&&&%%%%%%%%%%%%%%\033[93m,,,,,,,,,,\033[39m\033[90m&%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,\033[39m\033[90m#%%%(\033[93m,,,,,,,,,,,,,\033[39m%#####",
        L"&&&%%%%%%%%%%%###\033[93m,,,,,,,,,\033[39m\033[90m&  ,%%(\033[93m,,,,,,,,,,,,,,,,,,,,,\033[39m\033[90m&.  %%&\033[93m,,,,,,,,,,,,,\033[39m#####",
        L"&&&&%%%%%%%%%##&\033[93m,,,,,,,,,,\033[39m\033[90m&%%%%%#\033[93m,,,,,,,,,,,,,,,,,,,,,\033[39m\033[90m&%%%%%&\033[93m,,,,,,,,,,,,,\033[39m#####",
        L"&&&&%%%%%%%%###\033[93m,,,,,,,,,,,,\033[39m\033[90m&%%%(\033[93m,,,,,,,,,,,,,,,,,,,,,,,\033[39m\033[90m&%%%&\033[93m,,,,,,,,,,,,,,,\033[39m%%%%",
        L"&&&&%%%%%%%%##&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m%%%%",
        L"&&&&%%%%%%%###\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m\033[90m&%%&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m&%%",
        L"&&&%%%%%%%###\033[93m&,,(((((((,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,(((((((*,,,,,,*\033[39m%%",
        L"%%%%%%%%#####\033[93m,,(((((((((,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*((((((((((,,,,,,*\033[39m%",
        L"%%###########\033[93m,,(((((((((,,,,,,,,,,,,,,,,\033[39m\033[91m#%%%%%#\033[93m,,,,,,,,,,,,,(((((((((((,,,,,,*\033[39m#",
        L"#############\033[93m,,,(((((((,,,,,,,,,,,,,,(\033[39m\033[91m/********/\033[93m*,,,,,,,,,,,,(((((((((,,,,,,,,\033[39m&",
        L"(((((((((((((\033[93m/,,,,,,,,,,,,,,,,,,,,,,,\033[39m\033[91m%**********%\033[93m,,,,,,,,,,,,,,,/((,,,,,,,,,,,*\033[39m",
        L"(((((((((((((#\033[93m,,,,,,,,,,,,,,,,,,,,,,,,\033[39m\033[91m%*********%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"((((((((((((((%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,*\033[39m\033[91m%/****/%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"(((((((((((((((&\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"(((((((((((((((#%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"((((((((((((((###%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"##################%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
        L"#################%\033[93m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\033[39m",
};

#define B00 L'╔'
#define B01 L'═'
#define B02 L'╗'
#define B10 L'║'
#define B11 L'.'
#define B12 L'║'
#define B20 L'╚'
#define B21 L'═'
#define B22 L'╝'

static wchar_t *BlocksColor[] =
    {
        L"\033[34m#\033[39m",
        L"\033[34m#\033[39m",
        L"\033[33m=\033[39m",
        L"\033[94m-\033[39m",
        L"\033[96m+\033[39m",
        L"\033[93m0\033[39m",
        L"\033[33m&\033[39m",
        L"\033[92m$\033[39m",
        L"\033[32m!\033[39m",
        L"\033[90m*\033[39m",
        L"\033[97m*\033[39m",
        L"\033[97m*\033[39m",
};

void Flush()
{
    WClearConsole();
}

void RenderUi(Game *game)
{
    WSetCursor(game->ScreenSize.x / 2, 1); //upper score bar
    wprintf(L"%d", game->Score);
    WSetCursor(2, game->ScreenSize.y); //down left status bar
    wprintf(L"%ls", game->Map.BotMessage);
    WSetCursor(1, game->ScreenSize.y);
}

void RenderGround(Game *game)
{
    WSetCursor(1, 1);
    int up = game->ScreenPos.y;
    int down = game->ScreenPos.y + game->ScreenSize.y;
    int left = game->ScreenPos.x;
    int right = game->ScreenPos.x + game->ScreenSize.x;
    int maxDown = game->Map.Height;
    int maxRight = game->Map.Width;

    for (int y = up; y < down; y++)
    {
        for (int x = left; x < right; x++)
        {
            if (x == left)
            {
                if (y == up)
                    wprintf(L"%lc", B00);
                else if (y == down - 1)
                    wprintf(L"%lc", B20);
                else
                    wprintf(L"%lc", B10);
            }
            else if (x == right - 1)
            {
                if (y == up)
                    wprintf(L"%lc", B02);
                else if (y == down - 1)
                    wprintf(L"%lc", B22);
                else
                    wprintf(L"%lc", B10);
            }
            else if (y == up || y == down - 1)
            {
                if (y == up && x == game->ScreenPos.x + (game->ScreenSize.x - wcslen(game->Map.ScoreMessage)) / 2)
                {
                    wprintf(L"%ls", game->Map.ScoreMessage);
                    x += wcslen(game->Map.ScoreMessage) - 1;
                }
                else if (y == down - 1 && x == game->ScreenPos.x + (game->ScreenSize.x - wcslen(game->Map.BotMessage)) / 2)
                {
                    wprintf(L"%ls", game->Map.BotMessage);
                    x += wcslen(game->Map.BotMessage) - 1;
                }
                else if (y == down - 1 && x == game->ScreenPos.x + 2)
                {
                    wprintf(L"%ls", game->Map.Copyright);
                    x += wcslen(game->Map.Copyright) - 1;
                }
                else if (y == up && x == game->ScreenPos.x + 2)
                {
                    wprintf(L"%ls", game->Map.ExitMessage);
                    x += wcslen(game->Map.ExitMessage) - 1;
                }
                else
                    wprintf(L"%lc", B01);
            }
            else if (game->Player.Coords.x == x && game->Player.Coords.y == y)
            {
                wprintf(L"\033[91m");
                wprintf(L"%lc", L'@');
                wprintf(L"\033[39m");
            }
            //else if (x < 0 || x >= maxRight || y < 0 || y >= maxDown)
            //{
            //    wprintf(L"%lc", L'#');
            //}
            else
            {
                //wprintf(L"\033[92m");
                //wprintf(L"%lc", Blocks[game->Map.Blocks[x][y]]);
                //wprintf(L"%lc", Blocks[(int)(perlin2d(x, y, 0.05f, 5) * 6)]);
                //wprintf(L"\033[39m");
                wprintf(L"%ls", BlocksColor[(int)(perlin2d(x + 1000000, y + 1000000, game->Frequency, game->Octaves) * 12)]);
                //wprintf(L"%d", (int)(perlin2d(x + 1000000, y + 1000000, 0.05f, 5) * 9));
            }
        }
    }
}

void RenderPlayer(Game *game)
{
    WSetCursor(game->Player.Coords.x - game->ScreenPos.x + 1, game->Player.Coords.y - game->ScreenPos.y);
    wprintf(L"\033[91m");
    wprintf(L"%lc", L'@');
    wprintf(L"\033[39m");
}

void RenderAll(Game *game)
{
    game->ScreenSize = GetConsoleSize();
    //Flush();
    RenderGround(game);
    //RenderPlayer(game);
    //RenderUi(game);
    WSetCursor(1, game->ScreenSize.y);
}

void RenderPika(Game *Game)
{
    WSetCursor(1, 1);
    for (int y = 0; y < LENGTH(Pika); y++)
    {
        wprintf(L"%ls\n", Pika[y]);
    }
}

#endif
